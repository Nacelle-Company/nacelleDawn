{% comment %}
  TODO:
  -  pull all logic out into {% liquid %} entries/variables
  - disable 'component-presale_product.css' if collection settings are on
  - possibly load css file if collection settings enabled (need to move data between .liquid & .css files???)
{% endcomment %}
{% comment %} LOGIC & Variables {% endcomment %}
{% liquid
  # variables
  assign templateSuffix = collection.template_suffix
  assign bodyStyles = ''
  assign textColor = ''
  assign bkNav = ''

  # BODY background image
  if section.settings.collection_background_image
    assign bkImage = true
    assign bkImageURL = section.settings.collection_background_image | image_url
    assign bkImageProp = 'background-image:url(' | append: bkImageURL | append: ');'
  endif
  # BODY background image repeat
  if section.settings.collection_bk_img_repeat
    assign bkRepeat = true
    assign bkRepeatProp = 'background-repeat:repeat;'
  endif
  # BODY background color props
  if section.settings.collection_bk_color != '#f5f5f5'
    assign bkColor = true
    assign bkColorProp = 'background-color:' | append: section.settings.collection_bk_color | append: ';'
  endif
  # BODY background overlay
  # if section.settings.collection_bk_overlay
  #   assign bkOverlay = '.content-for-layout:before, #shopify-section-header:before, #shopify-section-footer:before {content: "";background-color:' | append: section.settings.collection_bk_overlay | append: ';width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index: -1;}'
  # endif

  # BODY final styles
  capture bodyStyles
    if bkImage or bkColor
      assign bkCustom = true
      if section.settings.collection_bk_img_none
        echo 'background-image:none;'
      elsif bkImage
        echo bkImageProp
        if bkRepeat
          echo bkRepeatProp
        endif
      endif
      if bkColor
        echo bkColorProp
      endif
    endif
  endcapture

  # NAV
  if bkImage or bkColor
    assign bkNav = '.footer.gradient, .header-wrapper{background-color:transparent !important;background-image:none !important;}'
  endif

  # text color
  if section.settings.collection_text_color != '#000000'
    capture textColor
      echo '.header__icons *,.header__inline-menu .first-parent > .header__menu-item,.header__inline-menu .first-parent summary.header__menu-item > span,.content-for-layout *:not(.shopify-payment-button), .footer * {color: ' | append: section.settings.collection_text_color | append: ' !important;}'
    endcapture
  endif
%}
{% capture customCSS %}

  body.presale-garloo {
    background-repeat-y: repeat;
    background-size: cover;
    background-attachment: scroll;
  }
{% endcapture %}
{% comment %}
  NEW .body styles
  NEW .body styles
  NEW .body styles
{% endcomment %}
{% if section.settings.collection_background_image %}
  {% liquid
    assign bkImg = true
    assign bkImageURL = section.settings.collection_background_image | image_url

    if section.settings.collection_bk_img_none
      assign bkImgProp = 'none'
    endif

    # background image
    unless section.settings.collection_bk_img_none
      if section.settings.collection_background_image
        assign bkImgProp = 'url(' | append: bkImageURL | append: ')'
        if section.settings.collection_bk_img_repeat
          assign bkImgRepeat = section.settings.collection_bk_img_repeat
        endif
        if section.settings.collection_bk_img_size
          assign bkImgSize = section.settings.collection_bk_img_size
        endif
      endif
    endunless

    if section.settings.collection_text_color != '#000000'
      assign bkColorProp = section.settings.collection_text_color
    endif
  %}
  {% capture bodyStylesNew %}
    body.{{ template.suffix }}.gradient {
      background-image: {{ bkImgProp }};
      background-color: {{ bkColorProp }};
      background-repeat: {{ bkImgRepeat }};
      background-size: {{ bkImgSize }};
    }
  {% endcapture %}
{% endif %}

{% comment %}
  BODY background overlay
{% endcomment %}
{% if section.settings.collection_bk_overlay %}
  {% capture bkOverlay %}
      .content-for-layout:before, 
      #shopify-section-header:before, 
      #shopify-section-footer:before {
        content: "";
        background-color: {{ section.settings.collection_bk_overlay }};
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
  {% endcapture %}
{% endif %}

<style>
  {{ customCSS }}
</style>
{%- if section.settings.alter_collection_style -%}
  <style>
    {% if bkImg %}
      .spaced-section:nth-of-type(1) {
          margin-top: 0;
      }
      .content-for-layout,
      #shopify-section-footer,
      #shopify-section-header {
          position: relative;
      }
    {% endif %}
    {{ bodyStylesNew }}
    {%- if bkCustom -%}body.{{ templateSuffix }} { {{ bodyStyles }} }{%- endif -%}{{ bkOverlay }}{{ textColor }}{{ bkNav }}
    {%- if section.settings.collection_text_color -%}
    .header__icons *, .header__inline-menu .first-parent > .header__menu-item, .header__inline-menu .first-parent summary.header__menu-item > span {
        color: {{ section.settings.collection_text_color }}
    }
    {%- endif -%}
    {{ textColor }}
  </style>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.main-collection-settings.name",
  "class": "main-collection-settings",
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.main-collection-settings.settings.paragraph.content"
    },
    {
      "type": "checkbox",
      "id": "alter_collection_style",
      "label": "Alter collection style",
      "default": false,
      "info": "Change the collection style."
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "color",
      "id": "collection_text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Collection background"
    },
    {
      "type": "color",
      "id": "collection_bk_color",
      "label": "Background color",
      "default": "#f5f5f5"
    },
    {
      "type": "image_picker",
      "id": "collection_background_image",
      "label": "Collection background image"
    },
    {
      "type": "text",
      "id": "collection_bk_overlay",
      "label": "Background overlay color",
      "default": "rgb(0 0 0 / 67%)",
      "info": "Copy and paste rgba color code from this color picker: https://hslpicker.com/#000,0.55"
    },
    {
      "type": "checkbox",
      "id": "collection_bk_img_none",
      "default": false,
      "label": "Background image none"
    },
    {
      "type": "select",
      "id": "collection_bk_img_size",
      "label": "Background image size",
      "options": [
        {
          "value": "contain",
          "label": "Contain"
        },
        {
          "value": "cover",
          "label": "Cover"
        },
        {
          "value": "unset",
          "label": "Unset"
        }
      ],
      "default": "contain"
    },
    {
      "type": "select",
      "id": "collection_bk_img_repeat",
      "label": "Background image repeat",
      "options": [
        {
          "value": "no-repeat",
          "label": "No repeat"
        },
        {
          "value": "repeat",
          "label": "Repeat"
        },
        {
          "value": "repeat-x",
          "label": "Repeat horizontally"
        },
        {
          "value": "repeat-y",
          "label": "Repeat vertically"
        }
      ],
      "default": "no-repeat"
    }
  ]
}
{% endschema %}
