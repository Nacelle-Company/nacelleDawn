{% comment %}
  NEW background image styles
{% endcomment %}
{% if section.settings.collection_background_image %}
  {% liquid
    assign bkImageURL = section.settings.collection_background_image | image_url
    assign bkImageURL_mobile = section.settings.collection_background_image_mobile | image_url

    # No background image checkbox enabled
    if section.settings.collection_bk_img_none
      assign bkImgProp = 'none'
    endif

    # background image uploaded
    unless section.settings.collection_bk_img_none
      if section.settings.collection_background_image
        assign bkImgProp = 'url(' | append: bkImageURL | append: ')'
        assign bkImgProp_mobile = 'url(' | append: bkImageURL_mobile | append: ')'

        if section.settings.collection_bk_img_repeat
          assign bkImgRepeat = section.settings.collection_bk_img_repeat
        endif
        if section.settings.collection_bk_img_size
          assign bkImgSize = section.settings.collection_bk_img_size
        endif
        assign bkImgAtt = section.settings.collection_bk_img_attachment
      endif
    endunless

    # background color
    if section.settings.collection_bk_color != blank
      assign bkColorProp = section.settings.collection_bk_color
    endif
  %}
  {% comment %} LOGIC end {% endcomment %}
  {% capture bodyStylesNew %}
    body.{{ template.suffix }}.gradient {
      background-image: {{ bkImgProp }};
      background-repeat: {{ bkImgRepeat }};
      background-color: {{ bkColorProp }};
      background-size: {{ bkImgSize }};
      background-attachment: {{ bkImgAtt }};
    }

  {% endcapture %}

  {% comment %} section styles for BODY image background {% endcomment %}
  {% capture stylesSections %}
    .spaced-section:nth-of-type(1) {
        margin-top: 0;
    }
    .content-for-layout,
    #shopify-section-footer,
    #shopify-section-header {
        position: relative;
    }
  {% endcapture %}
{% endif %}

{% comment %}
  BODY background overlay
{% endcomment %}
{% if section.settings.collection_bk_overlay != blank %}
  {% capture bkOverlay %}
      .content-for-layout:before, 
      #shopify-section-header:before, 
      #shopify-section-footer:before {
        content: "";
        background-color: {{ section.settings.collection_bk_overlay }};
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
  {% endcapture %}
{% endif %}

{% comment %}
  FOOTER background
{% endcomment %}
{% if section.settings.collection_background_image or section.settings.collection_bk_color %}
  {% capture stylesFooter %}
    .footer.gradient, .header-wrapper {
      background-color: transparent !important;
      background-image: none !important;
    }
  {% endcapture %}
{% endif %}

{% comment %}
  TEXT COLOR
{% endcomment %}
{% if section.settings.collection_text_color %}
  {% capture styleTextColor %}
    body *:not(.header__submenu *):not(.menu-drawer *) {
      color: {{ section.settings.collection_text_color }} !important;
    }
  {% endcapture %}
{% endif %}

{% comment %}
  Navigation logo to white
{% endcomment %}
{% if section.settings.nav_logo_white %}
  {% capture navLogoWhite %}
    .header__heading-logo {
      filter: brightness(3);
    }
  {% endcapture %}
{% endif %}

{% comment %} Apply the new styles to a style element {% endcomment %}
{%- if section.settings.alter_collection_style -%}
  <style>
    {{ bodyStylesNew }}
    {{ bkOverlay }}
    {{ navLogoWhite }}
    {{ stylesSections }}
    {{ styleTextColor }}
    {{ stylesFooter }}
  </style>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.main-collection-settings.name",
  "class": "main-collection-settings",
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.main-collection-settings.settings.paragraph.content"
    },
    {
      "type": "checkbox",
      "id": "alter_collection_style",
      "label": "Alter collection style",
      "default": false,
      "info": "Change the collection style."
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "color",
      "id": "collection_text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "checkbox",
      "id": "nav_logo_white",
      "label": "Top nav logo white",
      "default": false
    },
    {
      "type": "header",
      "content": "Collection background"
    },
    {
      "type": "color",
      "id": "collection_bk_color",
      "label": "Background color",
      "default": "#f5f5f5"
    },
    {
      "type": "image_picker",
      "id": "collection_background_image",
      "label": "Collection background image"
    },
    {
      "type": "text",
      "id": "collection_bk_overlay",
      "label": "Background overlay color",
      "default": "rgba(0, 0, 0, 0.67)",
      "info": "Overlay color on top of the background image. Copy and paste rgba color code from this [Color Picker](https://hslpicker.com) ex: rgba(0, 0, 0, 0.67)"
    },
    {
      "type": "checkbox",
      "id": "collection_bk_img_none",
      "default": false,
      "label": "Background image none"
    },
    {
      "type": "select",
      "id": "collection_bk_img_size",
      "label": "Background image size",
      "options": [
        {
          "value": "contain",
          "label": "Contain"
        },
        {
          "value": "cover",
          "label": "Cover"
        },
        {
          "value": "100% auto",
          "label": "Full width"
        },
        {
          "value": "unset",
          "label": "Unset"
        }
      ],
      "default": "contain"
    },
    {
      "type": "select",
      "id": "collection_bk_img_repeat",
      "label": "Background image repeat",
      "options": [
        {
          "value": "no-repeat",
          "label": "No repeat"
        },
        {
          "value": "repeat",
          "label": "Repeat"
        },
        {
          "value": "repeat-x",
          "label": "Repeat horizontally"
        },
        {
          "value": "repeat-y",
          "label": "Repeat vertically"
        }
      ],
      "default": "no-repeat"
    },
    {
      "type": "select",
      "id": "collection_bk_img_attachment",
      "label": "Background image attachment",
      "options": [
        {
          "value": "scroll",
          "label": "Scroll"
        },
        {
          "value": "fixed",
          "label": "Fixed"
        }
      ],
      "default": "scroll"
    }
  ]
}
{% endschema %}
