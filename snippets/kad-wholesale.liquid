<script id="kad-wholesale-config">
  	var KADWholesaleConfig = {
  	    appScriptUrl: "https://wholesale.kad.systems/script/kws.js",
        appStylesUrl: "https://wholesale.kad.systems/script/style.css",
        devScriptUrl: "https://test.preorder.kad.systems/script/kad-storefront-dev-tool.js",
        pageType: {{ request.page_type | json }},
      	customerTags: {{ customer.tags | json }},
      	moneyFormat: {{ shop.money_format | json }},
      	apiUrl:'/a/kad-wholesale'
    };
</script>

<script id="kad-wholesale-config-loader">
  ;(() => {
    try {
      function loadPersonalConfig() {
        let personalConfig = localStorage.getItem('KADWholesaleConfig')
        if (typeof personalConfig === 'string') {
          return JSON.parse(personalConfig)
        }
      }
      function savePersonalConfig(config) {
        localStorage.setItem('KADWholesaleConfig', JSON.stringify(config, null, 2))
      }
      function isDevParamSpecified() {
        return new URLSearchParams(window.location.search).get('kad-dev') !== null
      }
      let personalConfig = loadPersonalConfig()
      if (isDevParamSpecified()) {
        personalConfig = personalConfig || {}
        personalConfig.dev = true
      }
      if (personalConfig) {
        Object.assign(KADWholesaleConfig, personalConfig)
        savePersonalConfig(personalConfig)
      }
    } catch (err) {}
  })()
</script>

<script id="kad-wholesale-injector">
  ;(() => {
    let injectAfter = document.getElementById('kad-wholesale-injector')
    function injectScript(url, type) {
      const script = document.createElement('script')
      script.src = url
      script.type = type || ''
      script.async = false
      script.defer = true
      injectAfter = injectAfter.parentNode.insertBefore(script, injectAfter.nextSibling)
    }
    function injectStyles(url) {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      injectAfter = injectAfter.parentNode.insertBefore(link, injectAfter.nextSibling)
    }
    if (KADWholesaleConfig.dev && KADWholesaleConfig.devScriptUrl) {
      injectScript(KADWholesaleConfig.devScriptUrl, KADWholesaleConfig.devScriptType)
    }
    if (KADWholesaleConfig.appStylesUrl) {
      injectStyles(KADWholesaleConfig.appStylesUrl)
    }
    if (KADWholesaleConfig.appScriptUrl) {
      injectScript(KADWholesaleConfig.appScriptUrl, KADWholesaleConfig.appScriptType)
    }
  })()
</script>
